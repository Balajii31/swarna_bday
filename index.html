<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Swarna â€” Birthday Scrapbook (24 Nov)</title>
  <link rel="stylesheet" href="styles.css">
  <script>
    // Diagnostic: check whether styles.css is linked and applied
    (function(){
      function checkCss() {
        try {
          const sheets = Array.from(document.styleSheets).map(s => s.href).filter(Boolean);
          const found = sheets.some(h => h && h.endsWith('styles.css')) || sheets.some(h => h && h.includes('/styles.css'));
          console.log('DEBUG: styles.css linked (document.styleSheets):', found, sheets);
          const bodyStyle = window.getComputedStyle(document.body);
          console.log('DEBUG: computed body background:', bodyStyle.backgroundImage || bodyStyle.background);
        } catch (err) {
          console.error('DEBUG: css check failed', err);
        }
      }

      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', checkCss);
      } else {
        setTimeout(checkCss, 50);
      }
    })();
  </script>
</head>
<body>
  <div class="stars-container" id="starsContainer" aria-hidden="true"></div>
  <div class="confetti-splash" aria-hidden="true"></div>
  <canvas id="celebrationCanvas"></canvas>

  <audio id="birthdayAudio" loop src="https://interactive-examples.mdn.mozilla.net/media/examples/t-rex-roar.mp3"></audio>

  <nav class="nav" role="navigation" aria-label="Main navigation">
    <button class="nav-toggle" aria-expanded="false" aria-controls="primary-navigation" aria-label="Open menu">â˜°</button>
    <div class="nav-links" id="primary-navigation">
      <a href="#" data-page="home" class="active">Home</a>
      <a href="#" data-page="memories">Memories</a>
      <a href="#" data-page="messages">Messages</a>
      <a href="#" data-page="celebration">Celebration</a>
      <a href="#" data-page="surprise">Surprise</a>
    </div>
  </nav>
  <div class="menu-overlay" aria-hidden="true"></div>

  <!-- HOME PAGE -->
  <div id="home" class="page active">
    <header class="hero">
      <div class="balloon pink"></div>
      <div class="balloon lavender"></div>
      <div class="balloon mint"></div>
      <div class="balloon yellow"></div>
      <div class="streamer left"></div>
      <div class="streamer right"></div>
      <div class="party-hat" style="top: 15%; left: 8%;">ğŸ©</div>
      <div class="party-hat" style="top: 20%; right: 12%;">ğŸ‰</div>
      <div class="gift-box" style="bottom: 15%; left: 15%;" title="Click for surprise!"></div>
      <div class="gift-box" style="bottom: 20%; right: 20%; background: var(--lavender);" title="Click for surprise!"></div>
      
  <h1>ğŸ‰ Happy Birthday, Swarna! ğŸ‚ ğŸˆ</h1>
      <p id="typedMessage"></p>
      <div class="button-group">
        <button class="btn" id="celebrationBtn">ğŸŠ Confetti Mode ğŸŠ</button>
        <button class="btn" id="audioToggle">ğŸµ Play Music ğŸµ</button>
        <button class="btn" onclick="showPage('memories')">ğŸ“¸ Explore Memories</button>
      </div>
    </header>
  </div>

  <!-- MEMORIES PAGE -->
  <div id="memories" class="page">
    <section>
      <h2 class="section-title">ğŸ“¸ Memory Feed ğŸ“¸</h2>
      <form id="uploadForm" style="max-width: 500px; margin: 2rem auto; padding: 2rem; background: rgba(255,255,255,0.9); border-radius: 12px; box-shadow: var(--soft-shadow);">
        <input type="file" id="imageFile" accept="image/*" required style="margin-bottom: 1rem; width: 100%;" />
        <textarea id="caption" placeholder="Add a caption..." style="width: 100%; min-height: 80px; padding: 0.5rem; border-radius: 8px; border: 1px solid #ccc; margin-bottom: 1rem;"></textarea>
        <button type="submit" class="btn" style="width: 100%;">Post Memory âœ¨</button>
      </form>
      <button id="addMemoryBtn" class="btn" style="margin: 2rem auto; display: block;">Add New Memory â•</button>
      <div class="memory-feed" id="memoryFeed"></div>
    </section>
  </div>

  <!-- MESSAGES PAGE -->
  <div id="messages" class="page">
        <div class="memory-media">
          <img src="https://images.unsplash.com/photo-1517841905240-472988babdf9?auto=format&fit=crop&w=900&q=80" alt="Memory 2018" />
          <span class="sticker">2018</span>
        </div>
        <h3>First College Adventure</h3>
        <p>Remember how we got lost on day one and discovered the coziest cafe instead? Best accidental tradition ever.</p>
      </article>

      <article class="memory-card" data-type="video" data-media="https://interactive-examples.mdn.mozilla.net/media/cc0-videos/flower.mp4">
        <div class="memory-media">
          <video muted loop poster="https://images.unsplash.com/photo-1524504388940-b1c1722653e1?auto=format&fit=crop&w=900&q=80">
            <source src="https://interactive-examples.mdn.mozilla.net/media/cc0-videos/flower.mp4" type="video/mp4" />
          </video>
          <span class="sticker">2019</span>
        </div>
        <h3>Festival Lights Video</h3>
        <p>Our very first vlog attempt ï¿½ shaky camera, endless laughter, and pure magic.</p>
      </article>

      <article class="memory-card" data-type="image" data-media="https://images.unsplash.com/photo-1494790108377-be9c29b29330?auto=format&fit=crop&w=900&q=80">
        <div class="memory-media">
          <img src="https://images.unsplash.com/photo-1494790108377-be9c29b29330?auto=format&fit=crop&w=900&q=80" alt="Memory 2021" />
          <span class="sticker">2021</span>
        </div>
        <h3>Roadtrip Polaroids</h3>
        <p>That sunrise over the hills still feels unreal. We actually chased the clouds!</p>
      </article>

      <article class="memory-card" data-type="image" data-media="https://images.unsplash.com/photo-1524504388940-b1c1722653e1?auto=format&fit=crop&w=900&q=80">
        <div class="memory-media">
          <img src="https://images.unsplash.com/photo-1524504388940-b1c1722653e1?auto=format&fit=crop&w=900&q=80" alt="Memory 2024" />
          <span class="sticker">2024</span>
        </div>
        <h3>Starry Rooftop Sessions</h3>
        <p>Blankets, fairy lights, and unstoppable dream-building. The perfect ritual.</p>
      </article>
    </div>

    </section>
  </div>

  <!-- MESSAGES PAGE -->
  <div id="messages" class="page">
    <div class="balloon mint" style="top: 18%; left: 8%;"></div>
    <div class="balloon yellow" style="top: 22%; right: 10%;"></div>
    <div class="party-hat" style="top: 150px; left: 15%;">ğŸ’Œ</div>
    <div class="gift-box" style="top: 120px; right: 15%; background: var(--mint);"></div>
    <section>
    <h2 class="section-title">ğŸ’Œ Lift-the-Flap Surprises ğŸ’Œ</h2>
    <div class="flaps-grid">
      <div class="flap-card">
        <button>
          <span class="flap-front">Open me for sparkly memories </span>
          <span class="flap-back">You are the kind of friend who turns ordinary Tuesdays into constellations of joy. Never stop shining.</span>
        </button>
      </div>
      <div class="flap-card">
        <button>
          <span class="flap-front">A hidden photo awaits </span>
          <span class="flap-back"><img src="https://images.unsplash.com/photo-1524504388940-b1c1722653e1?auto=format&fit=crop&w=600&q=80" alt="Hidden polaroid" /></span>
        </button>
      </div>
      <div class="flap-card">
        <button>
          <span class="flap-front">Mini video letter </span>
          <span class="flap-back">Scan this QR-shaped hug:  Remember our karaoke chaos? A remix is waiting!</span>
        </button>
      </div>
    </div>
    </section>
  </div>

  <!-- CELEBRATION PAGE -->
  <div id="celebration" class="page">
    <div class="balloon pink" style="top: 12%; left: 12%;"></div>
    <div class="balloon lavender" style="top: 15%; right: 15%;"></div>
    <div class="balloon mint" style="bottom: 25%; left: 10%;"></div>
    <div class="balloon yellow" style="bottom: 20%; right: 12%;"></div>
    <div class="balloon pink" style="top: 25%; left: 25%;"></div>
    <div class="party-hat" style="top: 100px; left: 20%;">ğŸ‰</div>
    <div class="party-hat" style="top: 120px; right: 18%;">ğŸŠ</div>
    <div class="party-hat" style="top: 150px; left: 30%;">ğŸˆ</div>
    <div class="gift-box" style="top: 180px; left: 8%;"></div>
    <div class="gift-box" style="top: 200px; right: 10%; background: var(--soft-yellow);"></div>
    <div class="gift-box" style="top: 220px; left: 35%; background: var(--mint);"></div>
    <section>
    <h2 class="section-title">ğŸ‰ Pop-up Celebration Playground ğŸ‰</h2>
    <div class="celebration-playground">
      <div class="cake-card">
        <h3>Click to blow out the candles!</h3>
        <div class="cake" id="birthdayCake" data-lit="true">
          <div class="layer"></div>
          <div class="layer top"></div>
          <div class="candle">
            <div class="flame"></div>
          </div>
        </div>
        <p id="cakeMessage">Make a wish and tap the cake to blow out the candle.</p>
      </div>

      <div class="wheel-card">
        <div class="wheel-pointer"></div>
        <div class="wheel" id="wishWheel">Spin Me!</div>
        <button class="btn" id="spinWheelBtn" style="margin-top:1rem;">Spin for a wish</button>
        <p id="wheelResult"></p>
      </div>

    </div>
    </section>
  </div>

  <!-- GUESTBOOK PAGE -->
  <div id="surprise" class="page">
    <div class="balloon pink" style="top: 15%; left: 7%;"></div>
    <div class="balloon lavender" style="top: 18%; right: 9%;"></div>
    <div class="party-hat" style="top: 130px; left: 12%;">ğŸ</div>
    <div class="party-hat" style="top: 150px; right: 14%;">ğŸ‰</div>
    <div class="gift-box" style="bottom: 30%; left: 12%; background: var(--sky);"></div>
    <section>
    <h2 class="section-title">ğŸ Surprise Wish ğŸ</h2>
    <div class="surprise-banner" style="max-width: 900px; margin: 2rem auto; border-radius: var(--card-radius); overflow: hidden; box-shadow: var(--soft-shadow); border: 4px solid rgba(255, 154, 200, 0.5);">
      <img src="https://images.unsplash.com/photo-1511988617509-a57c8a288659?auto=format&fit=crop&w=1200&q=80" alt="Birthday Wish Banner" style="width: 100%; display: block; height: auto; max-height: 500px; object-fit: cover;" />
    </div>
    <div style="text-align: center; margin-top: 2rem; max-width: 800px; margin-left: auto; margin-right: auto; padding: 2rem; background: rgba(255, 255, 255, 0.9); border-radius: var(--card-radius); box-shadow: var(--soft-shadow);">
      <p style="font-size: 1.2rem; line-height: 1.8; color: #6d2d7c;">Here's to another amazing year filled with joy, laughter, and unforgettable moments! May all your wishes come true! âœ¨</p>
    </div>
    <!-- Old guestbook removed -->
    <div style="display:none;">
      <div class="note">
        "From sunrise pep-talks to midnight snack raids, you are pure delight." ï¿½ A Secret Well-Wisher 
      </div>
    </div>
    </div>
    </section>
  </div>

  <div id="addMemoryModal" style="display: none; position: fixed; inset: 0; background: rgba(36, 17, 52, 0.88); -webkit-backdrop-filter: blur(8px); backdrop-filter: blur(8px); z-index: 1000; align-items: center; justify-content: center; padding: 2rem; opacity: 0; transition: opacity 0.3s ease;">
    <div id="addMemoryModalContent" style="background: rgba(255, 255, 255, 0.95); border-radius: 30px; padding: 2.5rem; max-width: 500px; width: 100%; box-shadow: 0 30px 60px rgba(0,0,0,0.5), 0 0 40px rgba(255,154,200,0.3); transform: scale(0.9); transition: transform 0.3s ease;">
      <h3 style="text-align: center; color: #6d2d7c; margin-bottom: 1.5rem; font-size: 1.8rem;">Add New Memory ğŸ“¸</h3>
      <p style="text-align: center; color: #666; font-size: 0.9rem; margin-bottom: 1rem;">For permanent storage, upload images to a cloud service (like Google Drive, Imgur) and paste the shareable link below.</p>
      <form id="addMemoryForm">
        <div style="margin-bottom: 1rem;">
          <label for="memoryImageFile" style="display: block; margin-bottom: 0.5rem; font-weight: bold;">Upload Images:</label>
          <input type="file" id="memoryImageFile" accept="image/*" multiple style="width: 100%; padding: 0.5rem; border-radius: 8px; border: 1px solid #ccc;" />
        </div>
        <div style="margin-bottom: 1rem;">
          <label for="memoryImageUrl" style="display: block; margin-bottom: 0.5rem; font-weight: bold;">Or Image URL:</label>
          <input type="url" id="memoryImageUrl" placeholder="Paste image URL here" style="width: 100%; padding: 0.5rem; border-radius: 8px; border: 1px solid #ccc;" />
        </div>
        <div style="margin-bottom: 1rem;">
          <label for="memoryUsername" style="display: block; margin-bottom: 0.5rem; font-weight: bold;">Username:</label>
          <input type="text" id="memoryUsername" value="Swarna" style="width: 100%; padding: 0.5rem; border-radius: 8px; border: 1px solid #ccc;" />
        </div>
        <div style="margin-bottom: 1rem;">
          <label for="memoryCaption" style="display: block; margin-bottom: 0.5rem; font-weight: bold;">Caption:</label>
          <textarea id="memoryCaption" placeholder="Add a caption..." style="width: 100%; min-height: 100px; padding: 0.5rem; border-radius: 8px; border: 1px solid #ccc; resize: vertical;"></textarea>
        </div>
        <div id="imagePreview" style="margin-bottom: 1rem;"></div>
        <img id="previewImg" style="display: none; max-width: 100%; border-radius: 8px; margin-bottom: 1rem;" />
        <div style="display: flex; gap: 1rem;">
          <button type="submit" class="btn" style="flex: 1;">Add Memory âœ¨</button>
          <button type="button" id="closeAddMemoryModal" class="btn" style="flex: 1; background: rgba(255, 255, 255, 0.9); color: #6d2d7c;">Cancel</button>
        </div>
      </form>
    </div>
  </div>

  <div id="lightbox" aria-hidden="true" style="display:none; position:fixed; inset:0; background:rgba(36,17,52,0.88); -webkit-backdrop-filter: blur(8px); backdrop-filter: blur(8px); z-index:900; align-items:center; justify-content:center; padding:2rem; opacity:0; transition: opacity 0.3s ease;">
    <button id="closeLightbox" class="btn" style="position:absolute; top:2rem; right:2rem; z-index:901;">Close âœ•</button>
    <div id="lightboxContent" style="max-width:900px; width:100%; border-radius:24px; overflow:hidden; box-shadow:0 30px 60px rgba(0,0,0,0.5), 0 0 40px rgba(255,154,200,0.3); transform: scale(0.9); transition: transform 0.3s ease;"></div>
  </div>

  <footer style="text-align: center; padding: 2rem 1rem; background: rgba(255, 255, 255, 0.8); color: #6c3e74; position: relative; z-index: 1;">
    Made with âœ¨ glitter, ğŸ’» code, and ğŸ’– so much love.
  </footer>

  <script>
  const typedText = "Swarna â€” from our silliest bloopers to the boldest dreams, today celebrates the woman who colors every chapter of my story. Happy 24th November, Swarna! ğŸ‰";
    const typedMessageEl = document.getElementById('typedMessage');
    let charIndex = 0;
    function typeLoop() {
      if (charIndex <= typedText.length) {
        typedMessageEl.innerHTML = typedText.slice(0, charIndex) + '<span class="cursor">|</span>';
        charIndex++;
        setTimeout(typeLoop, 60);
      } else {
        typedMessageEl.innerHTML = typedText;
      }
    }

    // Multi-page navigation system
    window.showPage = function(pageId) {
      // Hide all pages
      document.querySelectorAll('.page').forEach(page => {
        page.classList.remove('active');
      });
      
      // Show selected page
      const targetPage = document.getElementById(pageId);
      if (targetPage) {
        targetPage.classList.add('active');
        
        // Update navigation active state
        document.querySelectorAll('.nav a').forEach(link => {
          link.classList.remove('active');
        });
        const navLink = document.querySelector(`[data-page="${pageId}"]`);
        if (navLink) navLink.classList.add('active');
        
        // Scroll to top
        window.scrollTo({ top: 0, behavior: 'smooth' });
        
        // Trigger page-specific animations
        if (pageId === 'home') {
          // Add more confetti on home page visit
          for (let i = 0; i < 30; i++) {
            setTimeout(createConfettiPiece, i * 50);
          }
        }
        
        // Add sparkles when switching pages
        setTimeout(() => {
          for (let i = 0; i < 10; i++) {
            setTimeout(() => {
              createSparkle(
                Math.random() * window.innerWidth,
                Math.random() * window.innerHeight
              );
            }, i * 50);
          }
        }, 200);
      }
    };

    // Navigation click handlers
    // Robust navigation: delegate clicks for any element with a data-page attribute
    document.addEventListener('click', (e) => {
      const navEl = e.target.closest('[data-page]');
      if (!navEl) return;
      // only handle navigation links inside the nav or with data-page attribute
      const pageId = navEl.getAttribute('data-page');
      if (!pageId) return;
      e.preventDefault();
      // close mobile nav if open
      const nav = document.querySelector('.nav');
      const toggle = nav ? nav.querySelector('.nav-toggle') : null;
      if (nav && nav.classList.contains('open')) {
        nav.classList.remove('open');
        if (toggle) toggle.setAttribute('aria-expanded', 'false');
      }
      if (typeof showPage === 'function') {
        showPage(pageId);
      } else {
        console.warn('showPage not defined yet for', pageId);
      }
    });

    // Mobile nav toggle behavior: open/close the collapsible nav on small screens
    (function setupMobileNavToggle(){
      const nav = document.querySelector('.nav');
      if (!nav) return;
      const toggle = nav.querySelector('.nav-toggle');
  const links = nav.querySelector('.nav-links');
  const overlay = document.querySelector('.menu-overlay');
      if (!toggle || !links) return;

      toggle.addEventListener('click', () => {
        const expanded = toggle.getAttribute('aria-expanded') === 'true';
        toggle.setAttribute('aria-expanded', String(!expanded));
        nav.classList.toggle('open');
      });

      // Close when overlay tapped
      if (overlay) {
        overlay.addEventListener('click', () => {
          nav.classList.remove('open');
          toggle.setAttribute('aria-expanded', 'false');
        });
      }

      // Close menu when a link is tapped (mobile)
      links.addEventListener('click', (e) => {
        if (e.target && e.target.matches('a')) {
          nav.classList.remove('open');
          toggle.setAttribute('aria-expanded', 'false');
        }
      });
    })();

    document.addEventListener('DOMContentLoaded', () => {
      typeLoop();
      document.getElementById('birthdayAudio').volume = 0.4;
      
      // Gift box interactions
      document.querySelectorAll('.gift-box').forEach((gift, index) => {
        gift.addEventListener('click', () => {
          // Create sparkle burst
          const rect = gift.getBoundingClientRect();
          for (let i = 0; i < 20; i++) {
            setTimeout(() => {
              createSparkle(
                rect.left + rect.width / 2 + (Math.random() - 0.5) * 80,
                rect.top + rect.height / 2 + (Math.random() - 0.5) * 80
              );
            }, i * 30);
          }
          
          // Show surprise message
          const messages = [
              'ğŸ Surprise! You found a hidden gift, Swarna!',
              'ğŸ‰ You\'re amazing, Swarna! Keep exploring!',
              'âœ¨ Your presence is the best gift!',
              'ğŸŠ Happy Birthday, Swarna!'
          ];
          const surprise = document.createElement('div');
          surprise.textContent = messages[index % messages.length];
          surprise.style.cssText = `
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: var(--gradient);
            padding: 2rem 3rem;
            border-radius: 30px;
            font-size: 1.5rem;
            font-weight: bold;
            color: #5d2e75;
            z-index: 1000;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            animation: popIn 0.5s ease-out;
          `;
          document.body.appendChild(surprise);
          setTimeout(() => {
            surprise.style.animation = 'popOut 0.5s ease-in forwards';
            setTimeout(() => surprise.remove(), 500);
          }, 2000);
          
          // Trigger mini confetti
          launchCelebration();
        });
      });
    });
    
    // Add pop animations for gift messages
    const giftStyle = document.createElement('style');
    giftStyle.innerHTML = `
      @keyframes popIn {
        from {
          transform: translate(-50%, -50%) scale(0);
          opacity: 0;
        }
        to {
          transform: translate(-50%, -50%) scale(1);
          opacity: 1;
        }
      }
      @keyframes popOut {
        from {
          transform: translate(-50%, -50%) scale(1);
          opacity: 1;
        }
        to {
          transform: translate(-50%, -50%) scale(0.5);
          opacity: 0;
        }
      }
    `;
    document.head.appendChild(giftStyle);

    // Floating stars animation
    const starsContainer = document.getElementById('starsContainer');
    const starEmojis = ['âœ¨', 'â­', 'ğŸŒŸ', 'ğŸ’«', 'â­'];
    
    function createStar() {
      const star = document.createElement('div');
      star.className = 'star';
      star.textContent = starEmojis[Math.floor(Math.random() * starEmojis.length)];
      star.style.left = `${Math.random() * 100}%`;
      star.style.top = `${Math.random() * 100}%`;
      star.style.animationDelay = `${Math.random() * 3}s`;
      star.style.animationDuration = `${3 + Math.random() * 2}s`;
      starsContainer.appendChild(star);
    }

    for (let i = 0; i < 20; i++) {
      createStar();
    }

    // Sparkle effects
    function createSparkle(x, y) {
      const sparkle = document.createElement('div');
      sparkle.className = 'star-sparkle';
      sparkle.style.left = `${x}px`;
      sparkle.style.top = `${y}px`;
      sparkle.style.animationDelay = `${Math.random() * 0.5}s`;
      document.body.appendChild(sparkle);
      setTimeout(() => sparkle.remove(), 4000);
    }

    // Add sparkles on hover over birthday elements (dynamic delegation for Instagram posts)
    document.addEventListener('mouseenter', (e) => {
      const target = e.target.closest('.btn, .memory-card, .cake, .flap-card button, .instagram-post, .post-action-btn');
      if (target && !target.dataset.sparkled) {
        target.dataset.sparkled = 'true';
        const rect = target.getBoundingClientRect();
        for (let i = 0; i < 3; i++) {
          setTimeout(() => {
            createSparkle(
              rect.left + Math.random() * rect.width,
              rect.top + Math.random() * rect.height
            );
          }, i * 100);
        }
        setTimeout(() => delete target.dataset.sparkled, 1000);
      }
    }, true);

    // Interactive decorations: balloons, party hats, streamers
    document.addEventListener('click', (e) => {
      const target = e.target.closest('.balloon, .party-hat, .streamer');
      if (target) {
        const rect = target.getBoundingClientRect();
        for (let i = 0; i < 10; i++) {
          setTimeout(() => {
            createSparkle(
              rect.left + Math.random() * rect.width,
              rect.top + Math.random() * rect.height
            );
          }, i * 50);
        }
        // Play a sound if available
        if (starSound) starSound.play().catch(() => {});
      }
    });

    // Emoji reactions for posts
    document.addEventListener('click', (e) => {
      if (e.target.classList.contains('emoji-react')) {
        const reactions = ['ğŸ˜Š', 'ğŸ˜‚', 'ğŸ¥°', 'ğŸ˜', 'ğŸ¤©', 'ğŸ˜', 'ğŸ™Œ', 'ğŸ’–'];
        const randomReaction = reactions[Math.floor(Math.random() * reactions.length)];
        const reactionEl = document.createElement('div');
        reactionEl.textContent = randomReaction;
        reactionEl.style.cssText = `
          position: fixed;
          top: ${e.clientY - 20}px;
          left: ${e.clientX - 10}px;
          font-size: 2rem;
          pointer-events: none;
          animation: floatUp 1s ease-out forwards;
          z-index: 1000;
        `;
        document.body.appendChild(reactionEl);
        setTimeout(() => reactionEl.remove(), 1000);
      }
    });

    // Add floatUp animation
    const reactionStyle = document.createElement('style');
    reactionStyle.innerHTML = `
      @keyframes floatUp {
        0% { transform: translateY(0) scale(1); opacity: 1; }
        100% { transform: translateY(-50px) scale(1.5); opacity: 0; }
      }
    `;
    document.head.appendChild(reactionStyle);

    // hero confetti sprinkles
    const confettiSplash = document.querySelector('.confetti-splash');
    function createConfettiPiece() {
      const piece = document.createElement('span');
      const size = Math.random() * 8 + 6;
      piece.style.position = 'absolute';
      piece.style.width = `${size}px`;
      piece.style.height = `${size * 0.4}px`;
      piece.style.background = `hsl(${Math.random()*360}, 80%, 75%)`;
      piece.style.top = '-10px';
      piece.style.left = `${Math.random() * 100}%`;
      piece.style.opacity = 0.8;
      piece.style.transform = `rotate(${Math.random()*180}deg)`;
      piece.style.animation = `fall ${5 + Math.random()*3}s linear forwards`;
      confettiSplash.appendChild(piece);
      setTimeout(() => piece.remove(), 9000);
    }

    for (let i = 0; i < 90; i++) {
      setTimeout(createConfettiPiece, i * 70);
    }

    const style = document.createElement('style');
    style.innerHTML = `@keyframes fall { to { transform: translateY(110vh) rotate(360deg); opacity: 0; } }`;
    document.head.appendChild(style);

    // Lightbox behavior
    const lightbox = document.getElementById('lightbox');
    const lightboxContent = document.getElementById('lightboxContent');
    let currentVideo = null;

    function openLightbox(media, type) {
      lightboxContent.innerHTML = '';
      lightboxContent.style.transform = 'scale(0.9)';
      
      if (type === 'video') {
        const video = document.createElement('video');
        video.controls = true;
        video.src = media;
        video.style.width = '100%';
        video.style.display = 'block';
        lightboxContent.appendChild(video);
        currentVideo = video;
        video.play().catch(() => {});
      } else {
        const img = document.createElement('img');
        img.src = media;
        img.alt = 'Expanded memory';
        img.style.width = '100%';
        img.style.display = 'block';
        lightboxContent.appendChild(img);
      }
      
      lightbox.style.display = 'flex';
      requestAnimationFrame(() => {
        lightbox.style.opacity = '1';
        lightboxContent.style.transform = 'scale(1)';
      });
    }

    function closeLightbox() {
      if (currentVideo) {
        currentVideo.pause();
        currentVideo = null;
      }
      lightbox.style.opacity = '0';
      lightboxContent.style.transform = 'scale(0.9)';
      setTimeout(() => {
        lightbox.style.display = 'none';
        lightboxContent.innerHTML = '';
      }, 300);
    }

  // Memory Feed System - Easy Instagram-style posts
  // Will be replaced by stored data (if present) after this declaration
  let memoriesData = [];

    // --- Persistence (localStorage) ---
    const STORAGE_KEY = 'swarna_memories_v2';

    function saveMemoriesToStorage() {
      try {
        localStorage.setItem(STORAGE_KEY, JSON.stringify(memoriesData));
      } catch (e) {
        console.warn('Failed to save memories to storage', e);
      }
    }

    function loadMemoriesFromStorage() {
      try {
        const raw = localStorage.getItem(STORAGE_KEY);
        if (!raw) return null;
        const parsed = JSON.parse(raw);
        if (Array.isArray(parsed)) return parsed;
      } catch (e) {
        console.warn('Failed to load memories from storage', e);
      }
      return null;
    }

    // If user has previously saved memories, use those instead of defaults
    (function initMemoriesFromStorage(){
      const stored = loadMemoriesFromStorage();
      if (stored && stored.length) {
        memoriesData = stored;
      }
    })();

    function renderMemories() {
      const feed = document.getElementById('memoryFeed');
      feed.innerHTML = '';
      
      memoriesData.forEach((memory, index) => {
        const post = document.createElement('div');
        post.className = 'instagram-post';
        post.innerHTML = `
          <div class="post-header">
              <div class="post-avatar">${memory.avatar || 'ğŸ‚'}</div>
            <div>
              <div class="post-username">${memory.username || 'Swarna'}</div>
            </div>
          </div>
          <div class="post-image-container" data-image="${memory.image}" data-index="${index}">
            <img src="${memory.image}" alt="Memory ${index + 1}" loading="lazy" style="width: 100%; aspect-ratio: 1; object-fit: cover; border-radius: 8px;" />
          </div>
          <div class="post-actions">
            <button class="post-action-btn" title="Like">â¤ï¸</button>
            <button class="post-action-btn" title="Comment">ğŸ’¬</button>
            <button class="post-action-btn" title="Share">ğŸ“¤</button>
            <button class="post-action-btn emoji-react" title="React">ğŸ˜Š</button>
            <button class="post-action-btn edit-btn" title="Edit">âœï¸</button>
            <button class="post-action-btn delete-btn" title="Delete">ğŸ—‘ï¸</button>
          </div>
          <div class="post-caption">
            <strong>${memory.username || 'Swarna'}</strong> ${memory.caption || ''}
          </div>
        `;
        feed.appendChild(post);
      });
    }

    // Add Memory Modal
    const addMemoryBtn = document.getElementById('addMemoryBtn');
    const addMemoryModal = document.getElementById('addMemoryModal');
    const addMemoryForm = document.getElementById('addMemoryForm');
    const closeAddMemoryModal = document.getElementById('closeAddMemoryModal');

    addMemoryBtn.addEventListener('click', () => {
      addMemoryModal.style.display = 'flex';
      requestAnimationFrame(() => {
        addMemoryModal.classList.add('active');
      });
    });

    closeAddMemoryModal.addEventListener('click', () => {
      addMemoryModal.classList.remove('active');
      setTimeout(() => {
        addMemoryModal.style.display = 'none';
        addMemoryForm.reset();
        imagePreview.style.display = 'none';
        selectedImageDataUrl = null;
      }, 300);
    });

    addMemoryModal.addEventListener('click', (e) => {
      if (e.target === addMemoryModal) {
        addMemoryModal.classList.remove('active');
        setTimeout(() => {
          addMemoryModal.style.display = 'none';
          addMemoryForm.reset();
          imagePreview.style.display = 'none';
          selectedImageDataUrl = null;
        }, 300);
      }
    });

    // Image file upload handler
    const memoryImageFile = document.getElementById('memoryImageFile');
    const imagePreview = document.getElementById('imagePreview');
    const previewImg = document.getElementById('previewImg');
    // Allow multiple selected images (data URLs)
    let selectedImages = []; // { name, dataUrl }

    memoryImageFile.addEventListener('change', (e) => {
      const files = Array.from(e.target.files || []);
      if (files.length) {
        // Clear URL input when file(s) are selected
        document.getElementById('memoryImageUrl').value = '';

        selectedImages = [];
        imagePreview.innerHTML = '';
        imagePreview.style.display = 'grid';
        imagePreview.style.gridTemplateColumns = 'repeat(auto-fit, minmax(80px, 1fr))';
        imagePreview.style.gap = '0.5rem';

        files.forEach((file) => {
          const reader = new FileReader();
          reader.onload = (ev) => {
            const dataUrl = ev.target.result;
            selectedImages.push({ name: file.name, dataUrl });

            // create thumbnail
            const thumb = document.createElement('img');
            thumb.src = dataUrl;
            thumb.alt = file.name;
            thumb.style.width = '100%';
            thumb.style.height = '80px';
            thumb.style.objectFit = 'cover';
            thumb.style.borderRadius = '8px';
            imagePreview.appendChild(thumb);

            // hide single previewImg (legacy) if present
            if (previewImg) previewImg.style.display = 'none';
          };
          reader.readAsDataURL(file);
        });
      } else {
        imagePreview.style.display = 'none';
        selectedImages = [];
        if (previewImg) previewImg.style.display = '';
      }
    });

    // URL input handler - clear file when URL is entered
    document.getElementById('memoryImageUrl').addEventListener('input', (e) => {
      if (e.target.value.trim()) {
        memoryImageFile.value = '';
        imagePreview.style.display = 'none';
        selectedImages = [];
        if (previewImg) previewImg.style.display = '';
      }
    });

    addMemoryForm.addEventListener('submit', async (e) => {
      e.preventDefault();
      let imageUrl = document.getElementById('memoryImageUrl').value.trim();
      const username = document.getElementById('memoryUsername').value.trim() || 'Swarna';
      const caption = document.getElementById('memoryCaption').value.trim();

      // If files were selected, add each image as an entry; otherwise use the imageUrl (single)
      if (selectedImages.length) {
        selectedImages.reverse().forEach(img => {
          memoriesData.unshift({
            image: img.dataUrl,
            username: username,
            avatar: 'ğŸ‚',
            caption: caption || ''
          });
        });
      } else if (imageUrl) {
        memoriesData.unshift({
          image: imageUrl,
          username: username,
          avatar: 'ğŸ‚',
          caption: caption || ''
        });
      }
      // Persist new memories
      try { saveMemoriesToStorage(); } catch (e) { /* ignore */ }
      // If no images were provided, do nothing
      if (!selectedImages.length && !imageUrl) return;

      // How many were added (for success message)
      const addedCount = selectedImages.length ? selectedImages.length : (imageUrl ? 1 : 0);

      // Re-render memories
      renderMemories();

      // Close modal
      addMemoryModal.classList.remove('active');
      setTimeout(() => {
        addMemoryModal.style.display = 'none';
        addMemoryForm.reset();
        imagePreview.style.display = 'none';
        imagePreview.innerHTML = '';
        selectedImages = [];

        // Scroll to top to see new post
        window.scrollTo({ top: 0, behavior: 'smooth' });
      }, 300);

      // Show success message
      const successMsg = document.createElement('div');
      successMsg.textContent = addedCount > 1 ? `âœ¨ ${addedCount} memories added successfully!` : 'âœ¨ Memory added successfully!';
      successMsg.style.cssText = `
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background: var(--gradient);
        padding: 1.5rem 2.5rem;
        border-radius: 25px;
        font-size: 1.2rem;
        font-weight: bold;
        color: #5d2e75;
        z-index: 2000;
        box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        animation: popIn 0.5s ease-out;
      `;
      document.body.appendChild(successMsg);
      setTimeout(() => {
        successMsg.style.animation = 'popOut 0.5s ease-in forwards';
        setTimeout(() => successMsg.remove(), 500);
      }, 2000);
    });

    // Initialize memory feed when page loads
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', () => {
        if (typeof renderMemories === 'function') {
          renderMemories();
        }
      });
    } else {
      // DOM already loaded
      if (typeof renderMemories === 'function') {
        renderMemories();
      }
    }

    // Override showPage to render memories when memories page is shown
    const originalShowPageFunction = window.showPage;
    window.showPage = function(pageId) {
      // Call original function first
      if (originalShowPageFunction) {
        originalShowPageFunction(pageId);
      }
      
      // Re-render memories when memories page is shown
      if (pageId === 'memories') {
        setTimeout(() => {
          if (typeof renderMemories === 'function') {
            renderMemories();
          }
        }, 100);
      }
    };

    // Old memory card click handlers (removed - now using new system)

    document.getElementById('closeLightbox').addEventListener('click', closeLightbox);
    lightbox.addEventListener('click', (e) => {
      if (e.target === lightbox) {
        closeLightbox();
      }
    });

    // ESC key to close lightbox
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape' && lightbox.style.display === 'flex') {
        closeLightbox();
      }
    });

    // Simple upload for memories
    document.addEventListener('DOMContentLoaded', () => {
      const uploadForm = document.getElementById('uploadForm');
      if (uploadForm) {
        uploadForm.addEventListener('submit', (e) => {
          e.preventDefault();
          const file = document.getElementById('imageFile').files[0];
          const caption = document.getElementById('caption').value.trim();
          if (file) {
            const reader = new FileReader();
            reader.onload = (ev) => {
              const imageUrl = ev.target.result;
              memoriesData.unshift({
                image: imageUrl,
                username: 'Swarna',
                avatar: 'ğŸ‚',
                caption: caption
              });
              saveMemoriesToStorage();
              renderMemories();
              uploadForm.reset();
            };
            reader.readAsDataURL(file);
          }
        });
      }
    });

    // Flap toggle
    document.querySelectorAll('.flap-card').forEach(flap => {
      flap.addEventListener('click', () => flap.classList.toggle('open'));
    });

    // Wish modal styling
    const wishModalStyle = document.createElement('style');
    wishModalStyle.innerHTML = `
      #wishModal {
        display: none;
        position: fixed;
        inset: 0;
        background: rgba(36, 17, 52, 0.88);
        -webkit-backdrop-filter: blur(8px);
        backdrop-filter: blur(8px);
        z-index: 1000;
        align-items: center;
        justify-content: center;
        padding: 2rem;
        opacity: 0;
        transition: opacity 0.3s ease;
      }
      #wishModal.active {
        display: flex;
        opacity: 1;
      }
      #wishModalContent {
        background: rgba(255, 255, 255, 0.95);
        border-radius: 30px;
        padding: 2.5rem;
        max-width: 500px;
        width: 100%;
        box-shadow: 0 30px 60px rgba(0,0,0,0.5), 0 0 40px rgba(255,154,200,0.3);
        transform: scale(0.9);
        transition: transform 0.3s ease;
      }
      #wishModal.active #wishModalContent {
        transform: scale(1);
      }
      #wishForm textarea {
        width: 100%;
        min-height: 150px;
        padding: 1rem;
        border-radius: 18px;
        border: 2px solid rgba(255, 154, 200, 0.3);
        font-size: 1rem;
        font-family: inherit;
        resize: vertical;
        margin-bottom: 1rem;
      }
      #wishForm textarea:focus {
        outline: none;
        border-color: var(--pink);
        box-shadow: 0 0 0 3px rgba(255, 154, 200, 0.2);
      }
    `;
    document.head.appendChild(wishModalStyle);

    // Cake interaction with wish form
    const cake = document.getElementById('birthdayCake');
    const cakeMessage = document.getElementById('cakeMessage');
    let wishModal = null;
    
    cake.addEventListener('click', () => {
      const isLit = cake.getAttribute('data-lit') === 'true';
      cake.setAttribute('data-lit', !isLit);
      
      // Add sparkle effect when blowing out
      if (isLit) {
        const rect = cake.getBoundingClientRect();
        for (let i = 0; i < 15; i++) {
          setTimeout(() => {
            createSparkle(
              rect.left + rect.width / 2 + (Math.random() - 0.5) * 60,
              rect.top + (Math.random() - 0.5) * 40
            );
          }, i * 50);
        }
        // Trigger confetti burst
        setTimeout(() => launchCelebration(), 200);
        
        // Show wish form after a short delay
        setTimeout(() => {
          showWishModal();
        }, 1500);
      }
      
      cakeMessage.textContent = isLit ? 'ğŸ‰ Wish granted! Candles out and dreams soaring. ğŸ‰' : 'âœ¨ Candles relit! You get another wish. âœ¨';
    });

    function showWishModal() {
      if (!wishModal) {
        wishModal = document.createElement('div');
        wishModal.id = 'wishModal';
        wishModal.innerHTML = `
          <div id="wishModalContent">
            <h3 style="text-align: center; color: #6d2d7c; margin-bottom: 1.5rem; font-size: 1.8rem;">âœ¨ Type Your Wish âœ¨</h3>
            <form id="wishForm">
              <textarea id="wishMessage" placeholder="Make a wish and it will be sent to me... ğŸŒŸ" required></textarea>
              <div style="display: flex; gap: 1rem;">
                <button type="submit" class="btn" style="flex: 1;">Send Wish ğŸ’Œ</button>
                <button type="button" class="btn" id="closeWishModal" style="flex: 1; background: rgba(255, 255, 255, 0.9); color: #6d2d7c;">Cancel</button>
              </div>
            </form>
          </div>
        `;
        document.body.appendChild(wishModal);
        
        document.getElementById('wishForm').addEventListener('submit', (e) => {
          e.preventDefault();
          const wish = document.getElementById('wishMessage').value.trim();
          if (wish) {
            sendWishEmail(wish);
            wishModal.classList.remove('active');
            setTimeout(() => {
              wishModal.style.display = 'none';
              document.getElementById('wishForm').reset();
            }, 300);
          }
        });
        
        document.getElementById('closeWishModal').addEventListener('click', () => {
          wishModal.classList.remove('active');
          setTimeout(() => {
            wishModal.style.display = 'none';
            document.getElementById('wishForm').reset();
          }, 300);
        });
        
        wishModal.addEventListener('click', (e) => {
          if (e.target === wishModal) {
            wishModal.classList.remove('active');
            setTimeout(() => {
              wishModal.style.display = 'none';
              document.getElementById('wishForm').reset();
            }, 300);
          }
        });
      }
      
      wishModal.style.display = 'flex';
      requestAnimationFrame(() => {
        wishModal.classList.add('active');
        document.getElementById('wishMessage').focus();
      });
    }

    function sendWishEmail(wish) {
      const email = 'balag31072002@gmail.com';
      const subject = encodeURIComponent('Birthday Wish from Scrapbook! ğŸ‚âœ¨');
      const body = encodeURIComponent(`A special birthday wish:\n\n${wish}\n\n- Sent from the Birthday Scrapbook ğŸ‰`);
      const mailtoLink = `mailto:${email}?subject=${subject}&body=${body}`;
      
      // Try to open email client
      window.location.href = mailtoLink;
      
      // Show success message
      const successMsg = document.createElement('div');
      successMsg.textContent = 'ğŸ’Œ Wish sent! Check your email client or copy the link.';
      successMsg.style.cssText = `
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background: var(--gradient);
        padding: 1.5rem 2.5rem;
        border-radius: 25px;
        font-size: 1.2rem;
        font-weight: bold;
        color: #5d2e75;
        z-index: 2000;
        box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        animation: popIn 0.5s ease-out;
      `;
      document.body.appendChild(successMsg);
      setTimeout(() => {
        successMsg.style.animation = 'popOut 0.5s ease-in forwards';
        setTimeout(() => successMsg.remove(), 500);
      }, 3000);
    }

    // Spin wheel
    const wheel = document.getElementById('wishWheel');
    const wheelResult = document.getElementById('wheelResult');
    const wishes = [
      'ğŸ• New food adventure',
      'ğŸ›ï¸ Shopping spree',
      'ğŸ¬ Movie night with me',
      'ğŸŒŸ A full day planned by me',
      'ğŸ² Truth or dare challenge',
      'ğŸ’ƒ Dance reel together'
    ];
    document.getElementById('spinWheelBtn').addEventListener('click', () => {
      const spin = 360 * 5 + Math.floor(Math.random() * 360);
      wheel.style.transform = `rotate(${spin}deg)`;
      const wishIndex = Math.floor(Math.random() * wishes.length);
      const wish = wishes[wishIndex];
      setTimeout(() => {
        wheelResult.textContent = wish;
        // Add confetti burst
        launchCelebration();
      }, 4200);
    });

    // Pull tabs
    document.querySelectorAll('.pull-tab').forEach(tab => {
      tab.querySelector('.pull-btn').addEventListener('click', () => tab.classList.toggle('open'));
    });

    // Guestbook removed - replaced with surprise section

    // Audio control
    const audio = document.getElementById('birthdayAudio');
    const audioToggle = document.getElementById('audioToggle');
    audioToggle.addEventListener('click', () => {
      if (audio.paused) {
        audio.play();
        audioToggle.textContent = 'Mute Music ';
      } else {
        audio.pause();
        audioToggle.textContent = 'Play Music ';
      }
    });

    // Celebration confetti mode
    const canvas = document.getElementById('celebrationCanvas');
    const ctx = canvas.getContext('2d');
    const celebrationBtn = document.getElementById('celebrationBtn');
    let confettiPieces = [];
    let animationId = null;

    function resizeCanvas() {
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;
    }
    window.addEventListener('resize', resizeCanvas);
    resizeCanvas();

    function launchCelebration() {
      if (animationId) {
        cancelAnimationFrame(animationId);
      }
      
      canvas.style.opacity = 1;
      confettiPieces = Array.from({ length: 250 }, () => ({
        x: Math.random() * canvas.width,
        y: Math.random() * -canvas.height,
        r: Math.random() * 8 + 4,
        d: Math.random() * 50 + 50,
        tilt: Math.random() * 10,
        tiltSpeed: (Math.random() - 0.5) * 0.2,
        vy: Math.random() * 3 + 2,
        vx: (Math.random() - 0.5) * 2,
        color: `hsl(${Math.random()*360},80%,70%)`
      }));
      
      audio.play().catch(() => {});
      renderConfetti();
      setTimeout(() => { 
        canvas.style.opacity = 0;
        if (animationId) {
          cancelAnimationFrame(animationId);
          animationId = null;
        }
      }, 8000);
    }

    function renderConfetti() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      let activePieces = 0;
      
      confettiPieces.forEach(p => {
        ctx.fillStyle = p.color;
        ctx.shadowBlur = 10;
        ctx.shadowColor = p.color;
        ctx.beginPath();
        ctx.ellipse(p.x, p.y, p.r, p.r/2, p.tilt, 0, Math.PI * 2);
        ctx.fill();
        ctx.shadowBlur = 0;
        
        p.y += p.vy;
        p.x += p.vx;
        p.tilt += p.tiltSpeed;
        p.vy += 0.1; // gravity
        
        if (p.y < canvas.height + 50) {
          activePieces++;
        } else {
          p.y = -10;
          p.x = Math.random() * canvas.width;
        }
      });
      
      if (canvas.style.opacity > 0 && activePieces > 0) {
        animationId = requestAnimationFrame(renderConfetti);
      }
    }

    celebrationBtn.addEventListener('click', () => {
      launchCelebration();
      // Add extra sparkles on button click
      const rect = celebrationBtn.getBoundingClientRect();
      for (let i = 0; i < 20; i++) {
        setTimeout(() => {
          createSparkle(
            rect.left + Math.random() * rect.width,
            rect.top + Math.random() * rect.height
          );
        }, i * 30);
      }
    });

    // Celebration sounds (soft star chime)
    const starSound = new Audio('https://cdn.pixabay.com/download/audio/2022/03/15/audio_f183f1cdd9.mp3?filename=magical-chime-113425.mp3');
    starSound.volume = 0.5;
    
    const originalCelebrationClick = celebrationBtn.onclick;
    celebrationBtn.addEventListener('click', () => {
      starSound.play().catch(() => {});
    });

    // Remove old smooth scrolling for anchor links (now handled by page system)

    // Defensive wiring: ensure nav links are directly hooked to showPage
    function wireNavLinks() {
      try {
        const navLinks = document.querySelectorAll('.nav-links a[data-page]');
        navLinks.forEach(link => {
          // avoid attaching duplicate listeners
          if (link._wiredForNav) return;
          link._wiredForNav = true;
          link.addEventListener('click', (ev) => {
            ev.preventDefault();
            const pageId = link.getAttribute('data-page');
            // close mobile nav if open
            const nav = document.querySelector('.nav');
            if (nav && nav.classList.contains('open')) {
              nav.classList.remove('open');
              const toggle = nav.querySelector('.nav-toggle');
              if (toggle) toggle.setAttribute('aria-expanded', 'false');
            }
            if (typeof showPage === 'function') {
              try { showPage(pageId); } catch (err) { console.error('showPage error:', err); }
            } else {
              console.warn('showPage is not defined when clicking nav link', pageId);
            }
          });
        });
      } catch (err) {
        console.error('Error wiring nav links', err);
      }
    }

    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', wireNavLinks);
    } else {
      wireNavLinks();
    }
  </script>
</body>
</html>
